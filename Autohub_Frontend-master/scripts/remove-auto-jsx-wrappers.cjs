/* eslint-disable no-console */
const fs = require('fs');
const path = require('path');

const ROOT = path.resolve(__dirname, '..');
const SRC = path.join(ROOT, 'src');
const MARKER = 'Auto-generated by scripts/convert-js-jsx-to-jsx-wrappers.cjs';

function walk(dir) {
	const entries = fs.readdirSync(dir, { withFileTypes: true });
	const out = [];
	for (const e of entries) {
		const full = path.join(dir, e.name);
		if (e.isDirectory()) out.push(...walk(full));
		else out.push(full);
	}
	return out;
}

const jsFiles = walk(SRC).filter((f) => f.endsWith('.js'));
let removed = 0;
let skipped = 0;

for (const file of jsFiles) {
	const code = fs.readFileSync(file, 'utf8');
	if (!code.includes(MARKER)) continue;

	const jsxFile = file.replace(/\.js$/, '.jsx');
	if (!fs.existsSync(jsxFile)) {
		skipped += 1;
		continue;
	}

	fs.unlinkSync(file);
	removed += 1;
}

console.log(`Removed ${removed} auto-generated wrapper .js files`);
console.log(`Skipped ${skipped} wrappers without a sibling .jsx`);

